<style>
    @import url('https://fonts.googleapis.com/css2?family=TikTok+Sans:opsz,wght@12..36,300..900&display=swap');

    .tt-player-wrapper {
        width: 100%;
        max-width: 100%;
        height: 90vh;
        background: #000;
        border-radius: 0;
        overflow: hidden;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        position: relative;
        z-index: 1;
        font-family: "TikTok Sans", sans-serif;
        font-optical-sizing: auto;
        font-style: normal;
        font-variation-settings: "slnt" 0, "wdth" 100;
        user-select: none;
        -webkit-user-select: none;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    .tt-player-wrapper * {
        box-sizing: border-box;
    }

    .tt-scroll-area {
        width: 100%;
        max-width: 100%;
        height: 100%;
        overflow-x: hidden;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        scroll-behavior: smooth;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        position: relative;
    }

    .tt-scroll-area::-webkit-scrollbar {
        display: none;
    }

    .tt-video-slide {
        width: 100%;
        max-width: 100%;
        height: 100%;
        scroll-snap-align: start;
        scroll-snap-stop: always;
        position: relative;
        background: #000;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }

    .tt-video-slide video {
        width: 100%;
        max-width: 100%;
        height: 100%;
        display: block;
        transition: transform 0.3s ease;
        object-fit: cover;
    }

    .tt-video-slide video.is-horizontal {
        object-fit: contain;
        transform: scale(1.2);
    }

    .tt-overlay-info {
        position: absolute;
        bottom: 20px;
        left: 15px;
        right: 90px;
        color: #fff;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        pointer-events: none;
        z-index: 2;
        max-width: calc(100% - 105px);
    }

    .tt-username {
        font-weight: 700;
        font-size: 1em;
        margin-bottom: 4px;
        word-wrap: break-word;
    }

    .tt-description {
        font-weight: 400;
        font-size: 0.9em;
        opacity: 0.9;
        line-height: 1.3;
        word-wrap: break-word;
    }

    /* === SLIDER INTERACTIVO === */
    .tt-brand-slider {
        position: absolute;
        z-index: 10;
        cursor: grab;
        pointer-events: auto;
        transition: transform 0.2s ease;
        touch-action: pan-y;
    }

    .tt-brand-slider:active {
        cursor: grabbing;
    }

    .tt-slider-container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
    }

    .tt-slider-track {
        display: flex;
        width: 100%;
        height: 100%;
        position: relative;
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
    }

    .tt-slider-track.is-dragging {
        transition: none;
    }

    .tt-slider-item {
        flex-shrink: 0;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        margin: 0 5px;
        position: relative;
        transition: opacity 0.3s ease;
    }

    /* Imagen activa - completamente visible */
    /* Imagen activa - completamente visible */
    .tt-slider-item.active {
        opacity: 1;
    }

    /* Im√°genes NO activas - opacidad reducida */
    .tt-slider-item:not(.active) {
        opacity: 0.3;
        /* ‚Üê Cambia este valor (0.3 = m√°s transparente, 0.8 = menos transparente) */
    }

    /* ELIMINAR o COMENTAR estos estilos de degradado: */
    /*
.tt-slider-item:not(.active)::before {
    ...
}

.tt-slider-item.prev::after {
    ...
}

.tt-slider-item.next::after {
    ...
}
*/

    .tt-slider-item img {
        width: 100%;
        height: 100%;
        display: block;
        object-fit: cover;
        pointer-events: none;
    }

    .tt-slider-dots {
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 4px;
        z-index: 2;
        pointer-events: none;
    }

    .tt-slider-dot {
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        transition: all 0.3s ease;
    }

    .tt-slider-dot.active {
        background: rgba(255, 255, 255, 1);
        width: 12px;
        border-radius: 3px;
    }

    /* === ICONOS LATERALES === */
    .tt-side-actions {
        position: absolute;
        right: 10px;
        bottom: 80px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        z-index: 10;
        pointer-events: auto;
    }

    .tt-action-button {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        transition: transform 0.2s ease;
    }

    .tt-action-button:active {
        transform: scale(0.9);
    }

    .tt-action-icon {
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 4px;
    }

    .tt-action-icon img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    .tt-action-text {
        color: #fff;
        font-size: 11px;
        font-weight: 600;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    }

    .tt-mute-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        background: rgba(0, 0, 0, 0);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 50;
        cursor: pointer;
        backdrop-filter: blur(4px);
        transition: opacity 0.3s ease, transform 0.2s ease;
    }

    .tt-mute-overlay:active {
        transform: translate(-50%, -50%) scale(0.9);
    }

    .tt-mute-overlay svg {
        width: 40px;
        height: 40px;
        fill: #fff;
    }

    .tt-mute-overlay.is-hidden {
        opacity: 0;
        pointer-events: none;
    }

    .tt-play-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(2);
        opacity: 0;
        transition: opacity 0.2s;
        pointer-events: none;
        z-index: 5;
    }

    .tt-video-slide.is-paused .tt-play-icon {
        opacity: 0.7;
    }

    .tt-scroll-indicator {
        position: absolute;
        left: 25px;
        top: 50%;
        transform: translateY(-50%);
        z-index: 100;
        pointer-events: none;
        animation: scrollHintFade 5.5s ease-in-out infinite;
        max-width: 80px;
    }

    @keyframes scrollHintFade {

        0%,
        100% {
            opacity: 0;
        }

        10%,
        90% {
            opacity: 1;
        }
    }

    .tt-scroll-hand {
        width: 60px;
        height: 60px;
        position: relative;
        animation: scrollHandMove 5.5s ease-in-out infinite;
    }

    @keyframes scrollHandMove {
        0% {
            transform: translateY(100px);
        }

        50%,
        100% {
            transform: translateY(-20px);
        }
    }

    .tt-scroll-hand img {
        width: 100%;
        height: 100%;
        max-width: 100%;
        object-fit: contain;
        filter: drop-shadow(0 2px 12px rgba(0, 0, 0, 0.8));
    }

    .tt-scroll-trail {
        position: absolute;
        left: 0;
        top: 0;
        width: 4px;
        height: 140px;
        background: linear-gradient(to top,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.7) 50%,
                rgba(255, 255, 255, 0) 100%);
        border-radius: 2px;
        animation: scrollTrailMove 5.5s ease-in-out infinite;
        opacity: 0;
    }

    @keyframes scrollTrailMove {
        0% {
            transform: translateY(70px);
            opacity: 0;
        }

        20% {
            opacity: 1;
        }

        50% {
            transform: translateY(-30px);
            opacity: 0.9;
        }

        80%,
        100% {
            opacity: 0;
        }
    }

    .tt-player-wrapper.scrolled .tt-scroll-indicator {
        animation: fadeOutIndicator 0.5s forwards;
    }

    @keyframes fadeOutIndicator {
        to {
            opacity: 0;
            visibility: hidden;
        }
    }
</style>

<div class="tt-player-wrapper" id="tiktok-wrapper">
    <div class="tt-mute-overlay" id="tt-mute-btn">
        <svg viewBox="0 0 24 24">
            <path
                d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z" />
        </svg>
    </div>

    <div class="tt-scroll-indicator">
        <div class="tt-scroll-trail"></div>
        <div class="tt-scroll-hand">
            <img src="https://almacenesdelta.shop/wp-content/uploads/2025/12/pulgar.png" alt="Scroll">
        </div>
    </div>

    <div class="tt-scroll-area" id="tt-feed-scroller"></div>
</div>

<script>
    (function () {
        'use strict';

        // ===================================================================
        // üé® CONFIGURACI√ìN GLOBAL - MODIFICA AQU√ç
        // ===================================================================

        const CONFIG = {
            // ========================================
            // üìè SLIDER DE MARCA - CONFIGURACI√ìN
            // ========================================
            brandSlider: {
                enabled: true,

                // üé¨ AUTOPLAY
                autoplay: false,            // ‚Üê true = autoplay ON, false = autoplay OFF
                autoplaySpeed: 5000,       // Velocidad del autoplay (milisegundos)

                // üìê SLIDES VISIBLES
                visibleSlides: 1,          // ‚Üê Cu√°ntas im√°genes visibles despu√©s del activo (1, 2, 3, 4, etc.)
                slideWidth: '120px',       // Ancho de cada imagen individual
                slideHeight: '70px',       // Alto del slider
                peekPrevious: '0px',      // Cu√°nto se ve del slide anterior (peek izquierdo)

                // üìç POSICI√ìN EN PANTALLA
                bottom: '115px',           // Distancia desde abajo
                left: '0px',               // Distancia desde la izquierda (0px = sin margen)
                right: 'auto',             // Distancia desde la derecha (usar 'auto' o un valor como '20px')

                // üé® ESTILO VISUAL
                borderRadius: '8px',       // Esquinas redondeadas
                boxShadow: '0 2px 8px rgba(0,0,0,0.4)',
                slideGap: '1px',          // Espacio entre slides
                marginLeft: '5px',        // Margen interno izquierdo del primer slide
                marginRight: '5px',       // Margen interno derecho del √∫ltimo slide

                // ‚öôÔ∏è COMPORTAMIENTO
                showDots: true,            // Mostrar puntos indicadores
                dragSensitivity: 10        // P√≠xeles m√≠nimos para cambiar slide (menor = m√°s sensible)
            },
            // ========================================

            sideActions: {
                enabled: true,
                bottom: '80px',
                right: '10px',
                iconSize: '45px',
                gap: '20px',

                icons: {
                    like: 'https://cdn-icons-png.flaticon.com/512/2589/2589175.png',
                    comment: 'https://cdn-icons-png.flaticon.com/512/2593/2593491.png',
                    save: 'https://cdn-icons-png.flaticon.com/512/5662/5662990.png',
                    share: 'https://cdn-icons-png.flaticon.com/512/3024/3024593.png'
                }
            }
        };

        // ===================================================================
        // üìπ VIDEOS - AQU√ç DEFINES TUS VIDEOS Y LOS IDS DE CADA IMAGEN
        // ===================================================================
        const VIDEOS = [
            {
                id: 'laptop-nitro',
                src: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/From-KlickPin-CF-–í–∏–¥–µ–æ-–í–∏–¥–µ–æ-MSI-Thin-GF63-156-144Hz-Gaming-Laptop-Intel-Core-i7-12650H-NVIDIA-GeForce-RTX-4050-32GB-RAM-1TB-NVMe-SSD-Type-C-Cooler-Boost-5-Win11-Free-Accessory-Bu‚Ä¶-_-–ù–æ—É—Ç–±—É–∫.mp4',
                username: 'Almacenes Delta',
                description: 'La reina calidad-precio. Nitro 5 con RTX 3050 üî•',
                vertical: true,
                // ‚¨áÔ∏è AQU√ç DEFINES CADA IMAGEN DEL SLIDER CON SU ID √öNICO
                brandSlider: [
                    {
                        url: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/Screenshot-2025-12-12-124657.png',
                        id: 'open-smart-drawer',        // ‚Üê ID √∫nico (solo letras, n√∫meros y guiones)
                        link: '#color-negro',            // ‚Üê Link de destino (hash o URL completa)
                        alt: 'Nitro Negro'               // ‚Üê Texto alternativo (opcional)
                    },
                    {
                        url: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/Screenshot-2025-12-12-124657.png',
                        id: 'open-smart-drawer',
                        link: '#color-rojo',
                        alt: 'Nitro Rojo'
                    },
                    {
                        url: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/Screenshot-2025-12-12-124657.png',
                        id: 'open-smart-drawer',
                        link: '#color-azul',
                        alt: 'Nitro Azul'
                    }
                ],
                likes: '1.3M',
                comments: '6,162'
            },
            {
                id: 'laptop-tuf',
                src: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/From-KlickPin-CF-Unleash-Gaming-Power-with-Dell-Alienware-15-Review-Specs-and-Performance-Boost-üöÄ-Video-nel-2025.mp4',
                username: 'Almacenes Delta',
                description: 'Resistencia militar y dise√±o renovado. TUF F15 üõ°Ô∏è',
                vertical: false,
                brandSlider: [
                    {
                        url: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/Screenshot-2025-12-12-124657.png',
                        id: 'open-smart-drawer',
                        link: '#especificacion-16gb',
                        alt: 'TUF 16GB RAM'
                    },
                    {
                        url: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/Screenshot-2025-12-12-124657.png',
                        id: 'open-smart-drawer',
                        link: '#especificacion-32gb',
                        alt: 'TUF 32GB RAM'
                    }
                ],
                likes: '856K',
                comments: '3,421'
            },
            {
                id: 'laptop-msi',
                src: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/122160208635531013.mp4',
                username: 'MSIGaming',
                description: 'Elegancia y potencia en un chasis delgado.',
                vertical: true,
                brandSlider: [
                    {
                        url: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/Screenshot-2025-12-12-124657.png',
                        id: 'open-smart-drawer',
                        link: '#gpu-rtx3050',
                        alt: 'MSI RTX 3050'
                    },
                    {
                        url: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/Screenshot-2025-12-12-124657.png',
                        id: 'open-smart-drawer',
                        link: '#gpu-rtx3060',
                        alt: 'MSI RTX 3060'
                    },
                    {
                        url: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/Screenshot-2025-12-12-124657.png',
                        id: 'open-smart-drawer',
                        link: '#gpu-rtx4050',
                        alt: 'MSI RTX 4050'
                    },
                    {
                        url: 'https://almacenesdelta.shop/wp-content/uploads/2025/12/Screenshot-2025-12-12-124657.png',
                        id: 'open-smart-drawer',
                        link: '#gpu-rtx4060',
                        alt: 'MSI RTX 4060'
                    }
                ],
                likes: '2.1M',
                comments: '8,934'
            }
        ];

        const BUFFER_SIZE = 2;
        const SCROLL_THRESHOLD = 0.6;

        let soundOn = false;
        let currentVideo = null;
        let currentIndex = 0;
        let slides = [];
        let isScrolling = false;
        let scrollTimeout = null;
        let hasScrolled = false;
        let sliderIntervals = new Map();
        let sliderStates = new Map();

        const scroller = document.getElementById('tt-feed-scroller');
        const muteBtn = document.getElementById('tt-mute-btn');
        const wrapper = document.getElementById('tiktok-wrapper');

        // Calcular ancho del contenedor seg√∫n slides visibles
        function calculateContainerWidth() {
            const slideWidth = parseInt(CONFIG.brandSlider.slideWidth);      // 200px
            const peekPrev = parseInt(CONFIG.brandSlider.peekPrevious);      // 50px
            const gap = parseInt(CONFIG.brandSlider.slideGap);               // 10px
            const visibleSlides = CONFIG.brandSlider.visibleSlides;          // 1
            const marginLeft = parseInt(CONFIG.brandSlider.marginLeft);      // 15px

            // Ancho total = margen + peek anterior + slide activo + slides siguientes + gaps
            const totalWidth = marginLeft + peekPrev + slideWidth + (slideWidth * visibleSlides) + (gap * (visibleSlides + 1));

            return `${totalWidth}px`;
        }

        function createSlider(images, slideId) {
            if (!images || images.length === 0) return '';

            const itemsHTML = images.map((item, index) => {
                const url = typeof item === 'string' ? item : item.url;
                const id = typeof item === 'string' ? '' : (item.id || '');
                const link = typeof item === 'string' ? '#' : (item.link || '#');
                const alt = typeof item === 'string' ? `Brand ${index + 1}` : (item.alt || `Brand ${index + 1}`);

                return `
                <a href="${link}" 
                   class="tt-slider-item ${index === 0 ? 'active' : ''}" 
                   data-index="${index}"
                   ${id ? `id="${id}"` : ''}
                   data-slide-link="${link}">
                    <img src="${url}" alt="${alt}" crossorigin="anonymous" draggable="false">
                </a>
            `;
            }).join('');

            const dotsHTML = CONFIG.brandSlider.showDots && images.length > 1 ? `
            <div class="tt-slider-dots">
                ${images.map((_, i) => `
                    <div class="tt-slider-dot ${i === 0 ? 'active' : ''}"></div>
                `).join('')}
            </div>
        ` : '';

            return `
            <div class="tt-brand-slider" data-slide-id="${slideId}">
                <div class="tt-slider-container">
                    <div class="tt-slider-track">
                        ${itemsHTML}
                    </div>
                    ${dotsHTML}
                </div>
            </div>
        `;
        }

        function updateSlideClasses(track, currentSlide, totalSlides) {
            const items = track.querySelectorAll('.tt-slider-item');

            items.forEach((item, index) => {
                item.classList.remove('active', 'prev', 'next');

                if (index === currentSlide) {
                    item.classList.add('active');
                } else if (index === currentSlide - 1 || (currentSlide === 0 && index === totalSlides - 1)) {
                    item.classList.add('prev');
                } else if (index === currentSlide + 1 || (currentSlide === totalSlides - 1 && index === 0)) {
                    item.classList.add('next');
                }
            });
        }

        function updateSliderPosition(slider, currentSlide) {
            const track = slider.querySelector('.tt-slider-track');
            const dots = slider.querySelectorAll('.tt-slider-dot');
            const slideId = slider.dataset.slideId;
            const state = sliderStates.get(slideId);

            if (!state) return;

            const slideWidth = parseInt(CONFIG.brandSlider.slideWidth);
            const gap = parseInt(CONFIG.brandSlider.slideGap);
            const peekPrev = parseInt(CONFIG.brandSlider.peekPrevious);
            const marginLeft = parseInt(CONFIG.brandSlider.marginLeft);

            const offset = -(currentSlide * (slideWidth + gap)) + marginLeft + peekPrev;
            track.style.transform = `translateX(${offset}px)`;

            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === currentSlide);
            });

            updateSlideClasses(track, currentSlide, state.totalSlides);
        }

        function initSliderAutoplay(slider, images) {
            if (!CONFIG.brandSlider.autoplay || !slider || images.length <= 1) return;

            const slideId = slider.dataset.slideId;

            const state = {
                currentSlide: 0,
                totalSlides: images.length,
                isPaused: false
            };

            sliderStates.set(slideId, state);

            const interval = setInterval(() => {
                if (!state.isPaused) {
                    state.currentSlide = (state.currentSlide + 1) % state.totalSlides;
                    updateSliderPosition(slider, state.currentSlide);
                }
            }, CONFIG.brandSlider.autoplaySpeed);

            sliderIntervals.set(slideId, interval);

            updateSliderPosition(slider, 0);
        }

        function initSliderDrag(slider, images) {
            if (!slider || images.length <= 1) return;

            const track = slider.querySelector('.tt-slider-track');
            const sliderElement = slider; // El elemento .tt-brand-slider
            const slideId = slider.dataset.slideId;
            let state = sliderStates.get(slideId);

            if (!state) {
                state = {
                    currentSlide: 0,
                    totalSlides: images.length,
                    isPaused: false
                };
                sliderStates.set(slideId, state);
            }

            let isDragging = false;
            let hasMoved = false;
            let startX = 0;
            let currentX = 0;
            let startTransform = 0;
            const slideWidth = parseInt(CONFIG.brandSlider.slideWidth);
            const gap = parseInt(CONFIG.brandSlider.slideGap);

            const getPositionX = (e) => {
                return e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            };

            const handleStart = (e) => {
                isDragging = true;
                hasMoved = false;
                startX = getPositionX(e);
                currentX = startX;

                const currentTransform = track.style.transform;
                const match = currentTransform.match(/translateX\(([^)]+)\)/);
                startTransform = match ? parseFloat(match[1]) : 0;

                track.classList.add('is-dragging');
                sliderElement.style.cursor = 'grabbing';

                if (CONFIG.brandSlider.autoplay) {
                    state.isPaused = true;
                }
            };

            const handleMove = (e) => {
                if (!isDragging) return;

                currentX = getPositionX(e);
                const diff = currentX - startX;

                if (Math.abs(diff) > 3) {
                    hasMoved = true;
                    e.preventDefault();
                    e.stopPropagation();
                }

                track.style.transform = `translateX(${startTransform + diff}px)`;
            };

            const handleEnd = (e) => {
                if (!isDragging) return;

                isDragging = false;
                track.classList.remove('is-dragging');
                sliderElement.style.cursor = 'grab';

                const diff = currentX - startX;
                const threshold = CONFIG.brandSlider.dragSensitivity;

                if (!hasMoved || Math.abs(diff) < 5) {
                    updateSliderPosition(slider, state.currentSlide);
                    return;
                }

                if (Math.abs(diff) > threshold) {
                    if (diff > 0) {
                        state.currentSlide = (state.currentSlide - 1 + state.totalSlides) % state.totalSlides;
                    } else {
                        state.currentSlide = (state.currentSlide + 1) % state.totalSlides;
                    }
                }

                updateSliderPosition(slider, state.currentSlide);

                if (CONFIG.brandSlider.autoplay) {
                    setTimeout(() => {
                        state.isPaused = false;
                    }, 1000);
                }
            };

            // Mouse events en el slider
            sliderElement.addEventListener('mousedown', handleStart, { passive: true });
            document.addEventListener('mousemove', handleMove, { passive: false });
            document.addEventListener('mouseup', handleEnd, { passive: true });

            // Touch events en el slider
            sliderElement.addEventListener('touchstart', handleStart, { passive: true });
            sliderElement.addEventListener('touchmove', handleMove, { passive: false });
            sliderElement.addEventListener('touchend', handleEnd, { passive: true });

            // Prevenir clicks en links cuando hubo arrastre
            const sliderLinks = slider.querySelectorAll('.tt-slider-item');
            sliderLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    if (hasMoved) {
                        e.preventDefault();
                        e.stopPropagation();
                        hasMoved = false;
                    }
                }, { capture: true });
            });
        }

        function stopSlider(slideId) {
            if (sliderIntervals.has(slideId)) {
                clearInterval(sliderIntervals.get(slideId));
                sliderIntervals.delete(slideId);
            }
            sliderStates.delete(slideId);
        }

        function createSlide(videoData, index) {
            const slide = document.createElement('div');
            slide.className = 'tt-video-slide';
            slide.dataset.targetId = videoData.id;
            slide.dataset.index = index;
            const slideId = `${videoData.id}-${index}`;

            const orientClass = videoData.vertical ? '' : 'is-horizontal';

            let slideHTML = `
            <div class="tt-play-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="rgba(255, 255, 255, 0.36)">
                    <path d="M8 5v14l11-7z"/>
                </svg>
            </div>
            <video 
                class="${orientClass}"
                src="${videoData.src}" 
                playsinline 
                loop 
                muted 
                disableRemotePlayback
                preload="metadata"
                webkit-playsinline="true">
            </video>
        `;

            if (CONFIG.brandSlider.enabled && videoData.brandSlider && videoData.brandSlider.length > 0) {
                slideHTML += createSlider(videoData.brandSlider, slideId);
            }

            if (CONFIG.sideActions.enabled) {
                slideHTML += `<div class="tt-side-actions"></div>`;
            }

            slideHTML += `
            <div class="tt-overlay-info">
                <div class="tt-username">${videoData.username}</div>
                <div class="tt-description">${videoData.description}</div>
            </div>
        `;

            slide.innerHTML = slideHTML;

            if (CONFIG.brandSlider.enabled) {
                const brandSlider = slide.querySelector('.tt-brand-slider');
                if (brandSlider) {
                    const containerWidth = calculateContainerWidth();

                    brandSlider.style.width = containerWidth;
                    brandSlider.style.height = CONFIG.brandSlider.slideHeight;
                    brandSlider.style.bottom = CONFIG.brandSlider.bottom;
                    brandSlider.style.left = CONFIG.brandSlider.left;

                    if (CONFIG.brandSlider.right !== 'auto') {
                        brandSlider.style.right = CONFIG.brandSlider.right;
                        brandSlider.style.left = 'auto';
                    }

                    const sliderItems = brandSlider.querySelectorAll('.tt-slider-item');
                    sliderItems.forEach(item => {
                        item.style.width = CONFIG.brandSlider.slideWidth;
                        item.style.minWidth = CONFIG.brandSlider.slideWidth;
                        item.style.height = CONFIG.brandSlider.slideHeight;
                        item.style.borderRadius = CONFIG.brandSlider.borderRadius;
                        item.style.boxShadow = CONFIG.brandSlider.boxShadow;
                    });

                    const track = brandSlider.querySelector('.tt-slider-track');
                    if (track) {
                        track.style.gap = CONFIG.brandSlider.slideGap;
                    }

                    setTimeout(() => {
                        initSliderAutoplay(brandSlider, videoData.brandSlider);
                        initSliderDrag(brandSlider, videoData.brandSlider);
                    }, 100);
                }
            }

            if (CONFIG.sideActions.enabled) {
                const sideActions = slide.querySelector('.tt-side-actions');
                if (sideActions) {
                    sideActions.style.bottom = CONFIG.sideActions.bottom;
                    sideActions.style.right = CONFIG.sideActions.right;
                    sideActions.style.gap = CONFIG.sideActions.gap;

                    const icons = sideActions.querySelectorAll('.tt-action-icon');
                    icons.forEach(icon => {
                        icon.style.width = CONFIG.sideActions.iconSize;
                        icon.style.height = CONFIG.sideActions.iconSize;
                    });
                }
            }

            const video = slide.querySelector('video');

            video.addEventListener('loadedmetadata', () => {
                if (video.videoWidth > video.videoHeight) {
                    video.classList.add('is-horizontal');
                }
            });

            slide.addEventListener('click', (e) => {
                if (e.target.closest('.tt-mute-overlay') ||
                    e.target.closest('.tt-brand-slider') ||
                    e.target.closest('.tt-action-button')) {
                    return;
                }

                if (video.paused) {
                    video.play();
                    slide.classList.remove('is-paused');
                } else {
                    video.pause();
                    slide.classList.add('is-paused');
                }
            });

            const actionButtons = slide.querySelectorAll('.tt-action-button');
            actionButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = btn.dataset.action;
                    handleAction(action, videoData.id, btn);
                });
            });

            slide.dataset.slideUniqueId = slideId;

            return slide;
        }

        function handleAction(action, videoId, button) {
            console.log(`Acci√≥n: ${action} en video: ${videoId}`);

            if (action === 'like') {
                button.classList.toggle('is-liked');
            }

            window.dispatchEvent(new CustomEvent('tt-action-clicked', {
                detail: { action, videoId }
            }));
        }

        function initSlides() {
            for (let i = 0; i < VIDEOS.length + BUFFER_SIZE; i++) {
                const videoIndex = i % VIDEOS.length;
                const slide = createSlide(VIDEOS[videoIndex], i);
                scroller.appendChild(slide);
                slides.push(slide);
            }
        }

        function loadMoreSlides(direction) {
            if (direction === 'down') {
                const lastSlide = slides[slides.length - 1];
                const lastIndex = parseInt(lastSlide.dataset.index);
                const nextIndex = lastIndex + 1;
                const videoIndex = nextIndex % VIDEOS.length;

                const slide = createSlide(VIDEOS[videoIndex], nextIndex);
                scroller.appendChild(slide);
                slides.push(slide);

                if (slides.length > VIDEOS.length * 3) {
                    const removed = slides.shift();
                    const slideId = removed.dataset.slideUniqueId;
                    if (slideId) stopSlider(slideId);
                    observer.unobserve(removed);
                    removed.remove();
                }

                observer.observe(slide);
            } else if (direction === 'up') {
                const firstSlide = slides[0];
                const firstIndex = parseInt(firstSlide.dataset.index);
                const prevIndex = firstIndex - 1;

                if (prevIndex < 0) return;

                const videoIndex = prevIndex % VIDEOS.length;
                const slide = createSlide(VIDEOS[videoIndex], prevIndex);
                scroller.insertBefore(slide, slides[0]);
                slides.unshift(slide);

                const slideHeight = slide.offsetHeight;
                scroller.scrollTop += slideHeight;

                if (slides.length > VIDEOS.length * 3) {
                    const removed = slides.pop();
                    const slideId = removed.dataset.slideUniqueId;
                    if (slideId) stopSlider(slideId);
                    observer.unobserve(removed);
                    removed.remove();
                }

                observer.observe(slide);
            }
        }

        scroller.addEventListener('scroll', () => {
            if (!hasScrolled) {
                hasScrolled = true;
                wrapper.classList.add('scrolled');
            }

            if (isScrolling) return;

            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const scrollTop = scroller.scrollTop;
                const scrollHeight = scroller.scrollHeight;
                const clientHeight = scroller.clientHeight;

                if (scrollHeight - (scrollTop + clientHeight) < clientHeight * 2) {
                    loadMoreSlides('down');
                }

                if (scrollTop < clientHeight * 2) {
                    loadMoreSlides('up');
                }
            }, 100);
        });

        let observer = null;

        function initObserver() {
            observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const slide = entry.target;
                    const video = slide.querySelector('video');
                    const targetId = slide.dataset.targetId;

                    if (entry.isIntersecting) {
                        currentVideo = video;
                        currentIndex = parseInt(slide.dataset.index);

                        if (video) {
                            video.currentTime = 0;
                            video.muted = !soundOn;

                            video.play().then(() => {
                                slide.classList.remove('is-paused');
                            }).catch(e => console.log('Autoplay bloqueado'));
                        }

                        window.dispatchEvent(new CustomEvent('tt-product-change', {
                            detail: { id: targetId }
                        }));
                    } else {
                        if (video) {
                            video.pause();
                            video.muted = true;
                        }
                        slide.classList.remove('is-paused');
                    }
                });
            }, {
                root: scroller,
                threshold: SCROLL_THRESHOLD
            });

            slides.forEach(slide => observer.observe(slide));
        }

        muteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            soundOn = true;

            if (currentVideo) {
                currentVideo.muted = false;
            }

            muteBtn.classList.add('is-hidden');
        });

        window.addEventListener('beforeunload', () => {
            sliderIntervals.forEach((interval, key) => {
                clearInterval(interval);
            });
            sliderIntervals.clear();
            sliderStates.clear();
        });

        initSlides();
        initObserver();
    })();
</script>