<div class="parati-layout">

  <div class="video-feed" id="videoFeed">
  </div>

  <div class="side-panel">

    <div class="panel-switcher">
      <div class="switch-btn active" onclick="switchTab('comments')">Comentarios</div>
      <div class="switch-btn" onclick="switchTab('reviews')">ReseÃ±as</div>
      <div class="switch-indicator"></div>
    </div>

    <div class="elementor-injector-container">
      <div id="comments-container-video-1" class="dynamic-comments active">
        [mi_plantilla id="ID_COMENTARIOS_VIDEO_1"]
      </div>
      <div id="comments-container-video-2" class="dynamic-comments">
        [mi_plantilla id="ID_COMENTARIOS_VIDEO_2"]
      </div>

      <div id="reviews-container" class="dynamic-comments" style="display:none;">
        [mi_plantilla id="ID_RESENAS_GENERAL"]
      </div>
    </div>

  </div>
</div>

<style>
  /* LAYOUT INTERNO */
  .parati-layout {
    display: flex;
    width: 100%;
    height: 90vh;
    background: #000;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
  }

  /* FEED DE VIDEO */
  .video-feed {
    flex: 1 1 0;
    min-width: 0;
    height: 100%;
    overflow: hidden;
    /* Scroll controlado por JS */
    position: relative;
    background: #000;
  }

  .video-item {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    transition: transform 0.5s cubic-bezier(0.65, 0, 0.35, 1);
    /* AnimaciÃ³n Suave */
    background: #000;
  }

  .video-item video {
    max-height: 100%;
    max-width: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    border-radius: 8px;
  }

  /* PANEL LATERAL */
  .side-panel {
    width: 350px;
    background: #121212;
    border-left: 1px solid #333;
    display: flex;
    flex-direction: column;
  }

  /* SWITCHER CORREGIDO */
  .panel-switcher {
    display: flex;
    position: relative;
    border-bottom: 1px solid #333;
    background: #121212;
  }

  .switch-btn {
    flex: 1;
    text-align: center;
    padding: 15px 0;
    cursor: pointer;
    font-weight: 600;
    color: #888;
    transition: 0.3s;
  }

  .switch-btn.active {
    color: #fff;
  }

  .switch-indicator {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 50%;
    height: 2px;
    background: #FE2C55;
    transition: left 0.3s ease;
  }

  /* CONTENEDORES DINÃMICOS */
  .dynamic-comments {
    display: none;
    height: 100%;
    overflow-y: auto;
  }

  .dynamic-comments.active {
    display: block;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ”Š INDICADOR DE PLAY/PAUSE CON ANIMACIÃ“N FADE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .video-item {
    cursor: pointer;
  }

  .video-play-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 20;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .video-play-indicator.show {
    opacity: 1;
    animation: paratisFadeInOut 1.2s ease forwards;
  }

  @keyframes paratisFadeInOut {
    0% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.8);
    }

    15% {
      opacity: 0.6;
      transform: translate(-50%, -50%) scale(1);
    }

    50% {
      opacity: 0.6;
      transform: translate(-50%, -50%) scale(1);
    }

    100% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(1.1);
    }
  }

  .video-play-indicator svg {
    width: 80px;
    height: 80px;
    fill: rgba(255, 255, 255, 0.6);
    filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.5));
  }

  /* Indicador de mute centrado sin background - solo visual, no interactivo */
  .video-mute-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 25;
    opacity: 0.7;
  }

  .video-mute-indicator svg {
    fill: #fff;
    width: 80px;
    height: 80px;
    filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.5));
  }

  /* Ocultar indicador de mute cuando ya estÃ¡ unmuted */
  .video-mute-indicator.hidden {
    display: none;
  }
</style>

<script>
  (function () {
    // CONFIGURACIÃ“N DE VIDEOS
    const VIDEOS = [
      {
        id: 1,
        src: "https://almacenesdelta.shop/wp-content/uploads/2025/12/122160208635531013.mp4",
        commentContainerId: "comments-container-video-1"
      },
      {
        id: 2,
        src: "https://www.w3schools.com/html/movie.mp4",
        commentContainerId: "comments-container-video-2"
      }
    ];

    let currentIndex = 0;
    let isScrolling = false;
    let isMuted = true; // Estado global del mute - empieza en mute
    const feed = document.getElementById('videoFeed');

    // FunciÃ³n para mostrar indicador de play/pause
    function showPlayPauseIndicator(indicator, isPlaying) {
      const playIcon = indicator.querySelector('.indicator-play');
      const pauseIcon = indicator.querySelector('.indicator-pause');

      // Mostrar el icono correcto
      playIcon.style.display = isPlaying ? 'none' : 'block';
      pauseIcon.style.display = isPlaying ? 'block' : 'none';

      // Quitar clase para reiniciar animaciÃ³n
      indicator.classList.remove('show');

      // Forzar reflow
      void indicator.offsetWidth;

      // Mostrar con animaciÃ³n
      indicator.classList.add('show');

      // Quitar despuÃ©s de animaciÃ³n
      setTimeout(() => {
        indicator.classList.remove('show');
      }, 1200);
    }

    // 1. RENDERIZAR VIDEOS CON NUEVOS CONTROLES
    function renderVideos() {
      feed.innerHTML = '';
      VIDEOS.forEach((v, i) => {
        const el = document.createElement('div');
        el.className = 'video-item';
        el.style.transform = `translateY(${(i - currentIndex) * 100}%)`;

        // Sin controles en el centro, solo indicadores visuales
        el.innerHTML = `
          <video src="${v.src}" loop playsinline muted ${i === 0 ? 'autoplay' : ''}></video>
          
          <!-- Indicador de Play/Pause con animaciÃ³n fade -->
          <div class="video-play-indicator">
            <svg viewBox="0 0 24 24" class="indicator-play" style="display:none;">
              <path d="M8 5v14l11-7z"/>
            </svg>
            <svg viewBox="0 0 24 24" class="indicator-pause" style="display:none;">
              <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
            </svg>
          </div>
          
          <!-- Indicador visual de mute (no interactivo) -->
          <div class="video-mute-indicator">
            <svg viewBox="0 0 24 24">
              <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
            </svg>
          </div>
        `;

        const video = el.querySelector('video');
        const playIndicator = el.querySelector('.video-play-indicator');
        const muteIndicator = el.querySelector('.video-mute-indicator');

        // Click en cualquier Ã¡rea del video
        el.addEventListener('click', () => {
          // Si estÃ¡ muted, el primer click quita el mute
          if (isMuted) {
            isMuted = false;

            // Actualizar el estado de mute en todos los videos de esta secciÃ³n
            Array.from(feed.children).forEach(item => {
              const vid = item.querySelector('video');
              if (vid) vid.muted = false;

              // Ocultar el indicador de mute en todos los videos
              const muteInd = item.querySelector('.video-mute-indicator');
              if (muteInd) muteInd.classList.add('hidden');
            });
            return;
          }

          // Si ya no estÃ¡ muted, controlar play/pause
          if (video.paused) {
            video.play();
            showPlayPauseIndicator(playIndicator, true);
          } else {
            video.pause();
            showPlayPauseIndicator(playIndicator, false);
          }
        });

        feed.appendChild(el);
      });
    }

    // 2. SCROLL SUAVE (Debounce)
    function handleScroll(e) {
      if (isScrolling) return;

      if (e.deltaY > 0 && currentIndex < VIDEOS.length - 1) {
        changeVideo(currentIndex + 1);
      } else if (e.deltaY < 0 && currentIndex > 0) {
        changeVideo(currentIndex - 1);
      }
    }

    function changeVideo(newIndex) {
      isScrolling = true;

      // Pausar video actual
      const currentItem = feed.children[currentIndex];
      const currentVid = currentItem.querySelector('video');
      currentVid.pause();
      currentVid.currentTime = 0;

      currentIndex = newIndex;

      // Mover videos visualmente
      Array.from(feed.children).forEach((el, i) => {
        el.style.transform = `translateY(${(i - currentIndex) * 100}%)`;
      });

      // Reproducir nuevo video con estado global de mute
      const nextItem = feed.children[currentIndex];
      const nextVid = nextItem.querySelector('video');
      nextVid.muted = isMuted;
      nextVid.play();

      // CAMBIAR COMENTARIOS
      updateCommentsPanel();

      // Cooldown para evitar scroll loco
      setTimeout(() => { isScrolling = false; }, 800);
    }

    // 3. ACTUALIZAR PANEL LATERAL
    function updateCommentsPanel() {
      // Ocultar todos
      document.querySelectorAll('.dynamic-comments').forEach(el => el.classList.remove('active'));

      // Mostrar el del video actual
      const targetId = VIDEOS[currentIndex].commentContainerId;
      const target = document.getElementById(targetId);
      if (target) target.classList.add('active');
    }

    // 4. SWITCHER LOGIC
    window.switchTab = function (tab) {
      const indicator = document.querySelector('.switch-indicator');
      const btns = document.querySelectorAll('.switch-btn');

      if (tab === 'comments') {
        indicator.style.left = '0%';
        btns[0].classList.add('active');
        btns[1].classList.remove('active');
        updateCommentsPanel(); // Volver a mostrar comentarios del video
        document.getElementById('reviews-container').classList.remove('active');
      } else {
        indicator.style.left = '50%';
        btns[0].classList.remove('active');
        btns[1].classList.add('active');
        // Ocultar comentarios, mostrar reseÃ±as
        document.querySelectorAll('.dynamic-comments').forEach(el => el.classList.remove('active'));
        document.getElementById('reviews-container').classList.add('active');
      }
    };

    // FunciÃ³n global para pausar todos los videos
    window.ParaTiSection = {
      pauseAllVideos: () => {
        Array.from(feed.children).forEach(item => {
          const video = item.querySelector('video');
          if (video) {
            video.pause();
            video.currentTime = 0;
          }
        });
        console.log('ğŸ”‡ Videos de Para Ti pausados');
      }
    };

    // INIT - Esperar a que el contenedor tenga dimensiones
    function init() {
      if (feed && feed.offsetHeight > 0) {
        renderVideos();
        feed.addEventListener('wheel', handleScroll);
        console.log('âœ… Para Ti inicializado con altura:', feed.offsetHeight);
      } else {
        // Reintentar hasta que el contenedor tenga altura
        setTimeout(init, 100);
      }
    }

    // Intentar inicializar cuando el DOM estÃ© listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      // PequeÃ±o delay para asegurar que Elementor haya terminado
      setTimeout(init, 50);
    }

  })();
</script>