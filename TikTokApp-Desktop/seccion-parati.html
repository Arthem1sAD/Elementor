<div class="parati-layout">

  <div class="video-feed" id="videoFeed">
  </div>

  <div class="side-panel">

    <div class="panel-switcher">
      <div class="switch-btn active" onclick="switchTab('comments')">Comentarios</div>
      <div class="switch-btn" onclick="switchTab('reviews')">Reseñas</div>
      <div class="switch-indicator"></div>
    </div>

    <div class="elementor-injector-container">
      <div id="comments-container-video-1" class="dynamic-comments active">
        [mi_plantilla id="ID_COMENTARIOS_VIDEO_1"]
      </div>
      <div id="comments-container-video-2" class="dynamic-comments">
        [mi_plantilla id="ID_COMENTARIOS_VIDEO_2"]
      </div>

      <div id="reviews-container" class="dynamic-comments" style="display:none;">
        [mi_plantilla id="ID_RESENAS_GENERAL"]
      </div>
    </div>

  </div>
</div>

<style>
  /* LAYOUT INTERNO */
  .parati-layout {
    display: flex;
    width: 100%;
    height: 100%;
    background: #000;
  }

  /* FEED DE VIDEO */
  .video-feed {
    flex: 1;
    height: 100%;
    overflow: hidden;
    /* Scroll controlado por JS */
    position: relative;
    background: #000;
  }

  .video-item {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    transition: transform 0.5s cubic-bezier(0.65, 0, 0.35, 1);
    /* Animación Suave */
  }

  .video-item video {
    max-height: 100%;
    max-width: 100%;
    object-fit: contain;
  }

  /* PANEL LATERAL */
  .side-panel {
    width: 350px;
    background: #121212;
    border-left: 1px solid #333;
    display: flex;
    flex-direction: column;
  }

  /* SWITCHER CORREGIDO */
  .panel-switcher {
    display: flex;
    position: relative;
    border-bottom: 1px solid #333;
    background: #121212;
  }

  .switch-btn {
    flex: 1;
    text-align: center;
    padding: 15px 0;
    cursor: pointer;
    font-weight: 600;
    color: #888;
    transition: 0.3s;
  }

  .switch-btn.active {
    color: #fff;
  }

  .switch-indicator {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 50%;
    height: 2px;
    background: #FE2C55;
    transition: left 0.3s ease;
  }

  /* CONTENEDORES DINÁMICOS */
  .dynamic-comments {
    display: none;
    height: 100%;
    overflow-y: auto;
  }

  .dynamic-comments.active {
    display: block;
  }
</style>

<script>
  (function () {
    // CONFIGURACIÓN DE VIDEOS
    const VIDEOS = [
      {
        id: 1,
        src: "https://almacenesdelta.shop/wp-content/uploads/2025/12/122160208635531013.mp4", // Ejemplo
        commentContainerId: "comments-container-video-1"
      },
      {
        id: 2,
        src: "https://www.w3schools.com/html/movie.mp4", // Ejemplo
        commentContainerId: "comments-container-video-2"
      }
    ];

    let currentIndex = 0;
    let isScrolling = false;
    const feed = document.getElementById('videoFeed');

    // 1. RENDERIZAR VIDEOS
    function renderVideos() {
      feed.innerHTML = '';
      VIDEOS.forEach((v, i) => {
        const el = document.createElement('div');
        el.className = 'video-item';
        el.style.transform = `translateY(${(i - currentIndex) * 100}%)`;
        el.innerHTML = `<video src="${v.src}" loop playsinline ${i === 0 ? 'autoplay' : ''}></video>`;
        feed.appendChild(el);
      });
    }

    // 2. SCROLL SUAVE (Debounce)
    function handleScroll(e) {
      if (isScrolling) return;

      if (e.deltaY > 0 && currentIndex < VIDEOS.length - 1) {
        changeVideo(currentIndex + 1);
      } else if (e.deltaY < 0 && currentIndex > 0) {
        changeVideo(currentIndex - 1);
      }
    }

    function changeVideo(newIndex) {
      isScrolling = true;

      // Pausar actual
      const currentVid = feed.children[currentIndex].querySelector('video');
      currentVid.pause();
      currentVid.currentTime = 0;

      currentIndex = newIndex;

      // Mover videos visualmente
      Array.from(feed.children).forEach((el, i) => {
        el.style.transform = `translateY(${(i - currentIndex) * 100}%)`;
      });

      // Reproducir nuevo
      const nextVid = feed.children[currentIndex].querySelector('video');
      nextVid.play();

      // CAMBIAR COMENTARIOS
      updateCommentsPanel();

      // Cooldown para evitar scroll loco
      setTimeout(() => { isScrolling = false; }, 800);
    }

    // 3. ACTUALIZAR PANEL LATERAL
    function updateCommentsPanel() {
      // Ocultar todos
      document.querySelectorAll('.dynamic-comments').forEach(el => el.classList.remove('active'));

      // Mostrar el del video actual
      const targetId = VIDEOS[currentIndex].commentContainerId;
      const target = document.getElementById(targetId);
      if (target) target.classList.add('active');
    }

    // 4. SWITCHER LOGIC
    window.switchTab = function (tab) {
      const indicator = document.querySelector('.switch-indicator');
      const btns = document.querySelectorAll('.switch-btn');

      if (tab === 'comments') {
        indicator.style.left = '0%';
        btns[0].classList.add('active');
        btns[1].classList.remove('active');
        updateCommentsPanel(); // Volver a mostrar comentarios del video
        document.getElementById('reviews-container').classList.remove('active');
      } else {
        indicator.style.left = '50%';
        btns[0].classList.remove('active');
        btns[1].classList.add('active');
        // Ocultar comentarios, mostrar reseñas
        document.querySelectorAll('.dynamic-comments').forEach(el => el.classList.remove('active'));
        document.getElementById('reviews-container').classList.add('active');
      }
    };

    // INIT
    renderVideos();
    feed.addEventListener('wheel', handleScroll);

  })();
</script>